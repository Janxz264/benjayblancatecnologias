<!-- Patient Modal (Used for Both Add & Edit) -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered"> <!-- Larger modal for better spacing -->
        <div class="modal-content">
            <div class="modal-header custom-header-bg text-white">
                <h5 class="modal-title" id="patientModalLabel">Agregar Paciente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="patientForm" class="custom-form-bg">
                    <input type="hidden" id="patientId"> <!-- Hidden field for Edit mode -->

                    <!-- First Row: Nombres, Apellido Paterno, Apellido Materno -->
                    <div class="row g-3"> <!-- g-3 adds spacing between elements -->
                        <div class="col-md-4">
                            <label for="name" class="form-label">Nombre</label>
                            <input type="text" class="form-control border rounded" id="name" maxlength="100" required>
                        </div>
                        <div class="col-md-4">
                            <label for="paterno" class="form-label">Apellido paterno</label>
                            <input type="text" class="form-control border rounded" id="paterno" maxlength="75" required>
                        </div>
                        <div class="col-md-4">
                            <label for="materno" class="form-label">Apellido materno</label>
                            <input type="text" class="form-control border rounded" id="materno" maxlength="75">
                        </div>
                    </div>

                    <!-- Second Row: Teléfono, Fecha de Nacimiento -->
                    <div class="row g-3 mt-3">
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Teléfono</label>
                            <input type="text" class="form-control border rounded" id="phone" maxlength="15">
                        </div>
                        <div class="col-md-6">
                            <label for="birthdate" class="form-label">Fecha de nacimiento</label>
                            <input type="date" class="form-control border rounded" id="birthdate" required>
                        </div>
                    </div>

                    <!-- Third Row: Estado, Municipio -->
                    <div class="row g-3 mt-3">
                        <div class="col-md-6">
                            <label for="state" class="form-label">Estado</label>
                            <select class="form-control border rounded" id="state" onchange="populateMunicipios()"></select>
                        </div>
                        <div class="col-md-6">
                            <label for="municipio" class="form-label">Municipio</label>
                            <select class="form-control border rounded" id="municipio"></select>
                        </div>
                    </div>

                    <!-- Checkbox for Assurance -->
                    <div class="form-check d-flex align-items-center gap-3 mt-3">
                        <input class="form-check-input custom-checkbox" type="checkbox" id="assuranceCheckbox" onchange="toggleAssuranceFields()">
                        <label class="form-check-label" for="assuranceCheckbox"><strong>¿Cuenta con seguro médico?</strong></label>
                    </div>

                    <!-- Assurance Fields (Initially Hidden) -->
                    <div id="assuranceFields" style="display: none;">
                        <div class="row g-3 mt-3">
                            <!-- Dropdown for existing assurances (Initially Hidden) -->
                            <div class="col-md-12" id="assuranceSelectContainer" style="display: none;">
                                <label for="assuranceSelect" class="form-label">Seleccione un seguro</label>
                                <select class="form-control border rounded" id="assuranceSelect" onchange="handleAssuranceSelection()">
                                    <option value="">-- Seleccione un seguro --</option>
                                </select>
                            </div>

                            <!-- Manual input field (Shown only when no assurance is selected) -->
                            <div id="assuranceManualField">
                                <div class="col-md-12">
                                    <label for="assuranceName" class="form-label">Nombre del seguro</label>
                                    <input type="text" class="form-control border rounded" id="assuranceName" maxlength="150">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Checkbox for Referral -->
                    <div class="form-check d-flex align-items-center gap-3 mt-3">
                        <input class="form-check-input custom-checkbox" type="checkbox" id="referredCheckbox" onchange="toggleDoctorFields()">
                        <label class="form-check-label" for="referredCheckbox"><strong>¿Fue referido por otro médico?</strong></label>
                    </div>

                    <!-- Doctor Fields (Initially Hidden) -->
                    <div id="doctorFields" style="display: none;">
                        <div class="row g-3 mt-3">
                            <!-- Dropdown for existing doctors (Initially Hidden) -->
                            <div class="col-md-12" id="doctorSelectContainer" style="display: none;">
                                <label for="doctorSelect" class="form-label">Seleccione al médico referente</label>
                                <select class="form-control border rounded" id="doctorSelect" onchange="handleDoctorSelection()">
                                    <option value="">-- Seleccione un médico --</option>
                                </select>
                            </div>

                            <!-- Manual input fields (Shown only when no doctor is selected) -->
                            <div id="doctorManualFields">
                                <label for="doctorManualFields" class="form-label">Si no aparece en la lista registre un nuevo doctor referente</label>
                                <div class="col-md-4">
                                    <label for="doctorName" class="form-label">Nombre</label>
                                    <input type="text" class="form-control border rounded" id="doctorName" maxlength="100">
                                </div>
                                <div class="col-md-4">
                                    <label for="doctorPaterno" class="form-label">Apellido paterno</label>
                                    <input type="text" class="form-control border rounded" id="doctorPaterno" maxlength="75">
                                </div>
                                <div class="col-md-4">
                                    <label for="doctorMaterno" class="form-label">Apellido materno</label>
                                    <input type="text" class="form-control border rounded" id="doctorMaterno" maxlength="75">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-success" id="savePatientBtn" onclick="savePatient()">Guardar</button>
            </div>
        </div>
    </div>
</div>